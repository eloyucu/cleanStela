extends ../layout
block scripts
	script(type='text/javascript', src='/javascripts/email/email.js')
block content
	h1=t('email_comunity')
	div(class="bs-callout bs-callout-info col-sm-12")
		h4=t('email_comunity_title')
		p=t('email_comunity_paragraph')
		h4=t('general_search_title')
		p=t('general_search')
	div.input-group.col-sm-4.col-md-offset-2
		span.input-group-addon
			span.glyphicon.glyphicon-search
		input(type="text" class="form-control" id="search_building")
	hr
	div(class="panel-group" id="accordion" role="tablist" aria-multiselectable="true")
		for building in buildings
			div.parent-divisor
				div(class="panel panel-default search-container" data-id_control="collapse#{building._id}")
					div(class="panel-heading" role="tab" id="heading#{building._id}")
						h4.panel-title
							a(data-toggle="collapse" data-parent="#accordion" href="#collapse#{building._id}" aria-expanded="false" aria-controls="collapse#{building._id}")
								div.row
									div.col-xs-1
										span.glyphicon.glyphicon-map-marker
									div.col-xs-4.inline.search-hit #{building.address.address}
									div.col-xs-3.inline.search-hit #{building.address.city}
									div.col-xs-3.inline.search-hit #{building.address.state}
				div(id="collapse#{building._id}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading#{building._id}")
					div.panel-body
						div(role="tabpanel")
							ul(class="nav nav-tabs margin-bottom" role="tablist")
								li(role="presentation" class="active")
									a(href="#messages#{building._id}" aria-controls="messages#{building._id}" role="tab" data-toggle="tab") #{t('email_cominity_messages_tab')}
								li(role="presentation")
									a(href="#send#{building._id}" aria-controls="send#{building._id}" role="tab" data-toggle="tab") #{t('email_cominity_send_tab')}
							div.tab-content
								div(role="tabpanel" class="tab-pane active" id="messages#{building._id}")
									for message in building.messages
										div(class="bs-callout bs-callout-warning col-sm-12")
											h4.left-float=message.title
											h2.right-nomargin=message.user_name
											div.clear
											h5.right=message.date
											div.clear
											p.margin-bottom.col-sm-10.col-xs-12=message.message
											input(class="btn button btn-default response" data-msn-id="#{message._id}" data-building-id="#{building._id}" type="button" value="#{t('email_response_button')}")
											for answer in message.answers
												div(class="bs-callout bs-callout-info col-sm-12")
													h4=answer.user_name
													p.margin-bottom=answer.message		
									else
										div(class="alert alert-warning alert-dismissible" id="myAlert" role="alert")
											button(type="button" class="close" data-dismiss="alert")
												span(aria-hidden="true") &times;
												span(class="sr-only") Close
											strong=t("email_no_msn_title")
											| #{t("email_no_msn")}
								div(role="tabpanel" class="tab-pane" id="send#{building._id}")
									form(class="form-horizontal" role="form" method="POST" action="comunity")
										div.form-group
											label(for="title" class="col-sm-2 control-label") TÃ­tulo
											div.col-xs-10.col-sm-5
												input(type="text" name="title" id="title" class="data form-control" required)
										div.form-group
											label(for="message" class="col-sm-2 control-label") Mensaje
											div.col-xs-10.col-sm-5
												textarea(type="text" name="message" id="message" class="data form-control" required)
										input(type="text" name="building_id" id="building_id" class="data form-control hide" value="#{building._id}")
										div.form-group
											div.col-sm-offset-10
												input(class="btn button btn-default"  type="submit" value="#{t('email_send_button')}")
		else
			div(class="alert alert-warning alert-dismissible" id="myAlert" role="alert")
				button(type="button" class="close" data-dismiss="alert")
					span(aria-hidden="true") &times;
					span(class="sr-only") Close
				strong=t("calendar_no_building_warning")
				| #{t("calendar_no_building")}
		div.hide.ocuppy-all#response
			div.form-ocuppy-all
				form(class="form-horizontal" role="form" method="POST" action="comunity")
					div.form-group
						label(for="message" class="col-sm-2 control-label") Mensaje
						div.col-xs-12
							textarea(type="text" rows="7" name="answer_message" id="message_response" class="data form-control" required)
					input(type="text" name="msn_id" id="answer_to_response" class="data form-control hide" value="")
					div.form-group
						div.col-sm-offset-10
							input(class="btn button btn-default" type="submit" value="#{t('email_send_button')}")